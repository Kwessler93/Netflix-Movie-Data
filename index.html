<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Netflix/Streaming Trends Analyzer</title>

  <!-- External Libraries -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }

    header {
      background-color: #333;
      color: white;
      padding: 10px;
      text-align: center;
    }

    #search-section,
    #upload-section {
      margin: 20px;
      text-align: center;
    }

    #movie-info {
      margin: 20px;
      padding: 10px;
      background-color: #fff;
      border-radius: 5px;
    }

    #visualizations {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin: 20px;
    }

    #line-graph,
    #scatter-plot {
      width: 45%;
      height: 400px;
      background-color: #fff;
      border-radius: 8px;
      padding: 10px;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    select {
      margin: 10px;
      padding: 5px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Netflix/Streaming Trends Analyzer</h1>
  </header>

  <!-- Movie Search Section -->
  <div id="search-section">
    <h2>Choose a Movie</h2>
    <select id="movie-dropdown">
      <option value="">Select a movie...</option>
    </select>
    <button id="search-btn">Search</button>
  </div>

  <!-- Year Selection Dropdown -->
  <div id="year-section">
    <h2>Select Year (2021-2023)</h2>
    <select id="year-select">
      <option value="2021">2021</option>
      <option value="2022">2022</option>
      <option value="2023">2023</option>
    </select>
  </div>

  <!-- Movie Info Section -->
  <div id="movie-info">
    <h3>Movie Information</h3>
    <p id="movie-description">Movie description will appear here...</p>
    <p id="movie-rating">Rating: </p>
  </div>

  <!-- Upload CSV Section -->
  <div id="upload-section">
    <h2>Upload CSV File</h2>
    <input type="file" id="csv-file" accept=".csv" />
  </div>

  <!-- Visualization Section -->
  <div id="visualizations">
    <div id="line-graph"></div>
    <div id="scatter-plot"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const movieDropdown = document.getElementById('movie-dropdown');
      const searchButton = document.getElementById('search-btn');
      const movieDescription = document.getElementById('movie-description');
      const movieRating = document.getElementById('movie-rating');
      const yearSelect = document.getElementById('year-select');
      const csvFileInput = document.getElementById('csv-file');

      let csvData = [];

      // Handle CSV upload
      csvFileInput.addEventListener('change', function (event) {
        const file = event.target.files[0];

        if (file) {
          Papa.parse(file, {
            header: true,
            dynamicTyping: true,
            complete: function (results) {
              csvData = results.data;
              console.log("Parsed CSV:", csvData.slice(0, 3));
              alert("CSV uploaded successfully!");
              populateMovieDropdown();
            },
            error: function (err) {
              console.error("CSV parse error:", err);
            }
          });
        }
      });

      // Populate dropdown with movie titles from 2021-2023
      function populateMovieDropdown() {
        const years = ['2021', '2022', '2023'];
        const filtered = csvData.filter(row => years.includes(String(row.release_year)));
        const uniqueTitles = [...new Set(filtered.map(row => row.title).filter(Boolean))];

        movieDropdown.innerHTML = '<option value="">Select a movie...</option>';
        uniqueTitles.forEach(title => {
          const option = document.createElement('option');
          option.value = title;
          option.textContent = title;
          movieDropdown.appendChild(option);
        });
      }

      // Handle search button click
      searchButton.addEventListener('click', function () {
        const selectedMovie = movieDropdown.value;
        const selectedYear = parseInt(yearSelect.value);

        if (!selectedMovie) {
          movieDescription.textContent = 'Please select a movie.';
          movieRating.textContent = '';
          return;
        }

        const found = csvData.find(row =>
          row.title === selectedMovie && row.release_year === selectedYear
        );

        if (found) {
          movieDescription.textContent = `Description: ${found.description || 'N/A'}`;
          movieRating.textContent = `IMDb Rating: ${found.imdb_rating || 'N/A'}`;
          plotSearchTrend(found);
          plotRatingComparison(csvData.filter(row => row.release_year === selectedYear));
        } else {
          movieDescription.textContent = 'Movie not found for that year.';
          movieRating.textContent = '';
        }
      });

      // Plot search interest trend
      function plotSearchTrend(movie) {
        const interest = typeof movie.search_interest === 'string'
          ? movie.search_interest.split(',').map(Number)
          : [movie.search_interest];

        const trace = {
          x: Array.from({ length: interest.length }, (_, i) => `Month ${i + 1}`),
          y: interest,
          type: 'scatter',
          mode: 'lines+markers',
          name: movie.title
        };

        Plotly.newPlot('line-graph', [trace], { title: `Search Trend: ${movie.title}` });
      }

      // Scatter plot of ratings vs search interest
      function plotRatingComparison(data) {
        const ratings = data.map(row => row.imdb_rating);
        const interest = data.map(row =>
          parseFloat(row.search_interest?.split(',')?.[0] || 0)
        );

        const trace = {
          x: ratings,
          y: interest,
          mode: 'markers',
          type: 'scatter',
          marker: { size: 10, color: 'darkred' },
          name: 'Movies'
        };

        Plotly.newPlot('scatter-plot', [trace], {
          title: 'IMDb Rating vs Initial Search Interest',
          xaxis: { title: 'IMDb Rating' },
          yaxis: { title: 'Search Interest (Month 1)' }
        });
      }
    });
  </script>
</body>

</html>
